#!/bin/bash

# Declare test counters
declare -i tc=0
declare -i fails=0

############################################
# Function to run a single test
############################################
test() {
    tc=tc+1

    local COMMAND=$1
    local INP=$2
    local EX_OUT=$3
    local EX_ERR=$4

    # Determine expected return code
    EX_RET=1
    if [[ ! -s $EX_ERR ]]; then
        EX_RET=0
    fi

    # Run the command
    $COMMAND < $INP > test_out.txt 2> test_err.txt
    RET=$?

    # Check return code
    if [[ $RET != $EX_RET ]]; then
        echo "TC $tc Failed (Return Code)"
        echo "Returned $RET, Expected $EX_RET"
        echo "-----------"
        fails=$fails+1
        return
    fi

    # Check standard output
    DIFF=$(diff test_out.txt $EX_OUT)
    if [[ $DIFF != '' ]]; then
        echo "TC $tc Failed (Standard Output)"
        echo "$DIFF"
        echo "-----------"
        fails=$fails+1
        return
    fi

    # Check standard error
    DIFF=$(diff test_err.txt $EX_ERR)
    if [[ $DIFF != '' ]]; then
        echo "TC $tc Failed (Standard Error)"
        echo "$DIFF"
        echo "-----------"
        fails=$fails+1
        return
    fi

    echo "TC $tc Passed"
}

############################################
# Test Cases
############################################

# Test 1: Player wins with higher value
test './testing_game_result' 'inp1.txt' 'out1.txt' 'empty.txt'

# Test 2: Dealer wins
test './testing_game_result' 'inp2.txt' 'out2.txt' 'empty.txt'

# Test 3: Player busts
test './testing_game_result' 'inp3.txt' 'out3.txt' 'empty.txt'

# Test 4: 5-Card Charlie
test './testing_game_result' 'inp4.txt' 'out4.txt' 'empty.txt'

# Test 5: Blackjack win
test './testing_game_result' 'inp5.txt' 'out5.txt' 'empty.txt'

# Test 6: Invalid bet amount
test './testing_game_result' 'inp6.txt' 'out6.txt' 'err6.txt'

# Test 7: Invalid input
test './testing_game_result' 'inp7.txt' 'out7.txt' 'err7.txt'

############################################
# Clean up
############################################

rm test_out.txt test_err.txt

# Return code
exit $fails
